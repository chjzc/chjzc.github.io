<!DOCTYPE html>
<html>
<head>
	<!<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.min.js"></script>
	<script type="text/javascript" src="./stack_graph.js"></script>
	<style type="text/css">
	button {
		position: absolute;
		right: 10px;
		top: 10px;
	}
	body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"Î¢ÈíÑÅºÚ";}
	</style>
</head>
<body>
	<div id="output"></div>
	<svg id = "svg1" width = "1000" height="800"></svg>
	<button onclick="myTranslate()">Update</button>
</body>
</html>
<script type="text/javascript">
	function bumpLayer(n) 
	{
		function bump(a) 
		{
			var x = 1 / (.1 + Math.random()),
			y = 2 * Math.random() - .5,
			z = 10 / (.1 + Math.random());
			for (var i = 0; i < n; i++) 
			{
				var w = (i / n - y) * z;
				a[i] += x * Math.exp(-w * w);
			}
		}
		//alert("1");
		var a = [], i;
		for (i = 0; i < n; ++i) a[i] = 0;
		for (i = 0; i < 5; ++i) bump(a);
		return a.map(function(d, i) { return {x: i * (800 / n), y: Math.max(0,d)*10.0};});
	}
	function resort(data)
	{
		//data.sort()
		var result=[];
		var total=0;
		var half=0;
		for(var i=0;i<data.length;i++)
		{
			if(i==0)
			{
				result.push(data[i]);
				total += data[i].weight;
				half += data[i].weight/2;
			}
			else
			{
				if(half>=total)
				{
					result.push(data[i]);
					total += data[i].weight;
					if((i+1)%2==0)
						half += result[(i-1)/2].weight/2;
					else
						half += result[i/2].weight/2	
				}
				else
				{
					result.unshift(data[i])
					total += data[i].weight;
					if((i+1)%2==0)
					{
						half -= [(i+1)/2].weight/2;
						half += result[0];
					}
					else
					{
						half -= [i/2].weight/2;
						half += result[0];
					}
				}
			}	
		}
		return result;
	}
	function compare(propertyName) { 
		return function (object1, object2) { 
			var value1 = object1[propertyName]; 
			var value2 = object2[propertyName]; 
			if (value2 > value1) { 
				return -1; 
			} 
			else if (value2 < value1) { 
				return 1; 
			} 
			else { 
				return 0; 
			} 
		} 
	} 
	//alert("!");
	var n = 10;
	var m = 20;
	var layer = [];
	for (var i=0;i<n;i++) 
	{
		layer[i] = {resource:[],weight:0,start:0};
		var resource = bumpLayer(m);
		var weight=0;
		var start=-1;
		for(var j=0;j<resource.length;j++)
		{
			if(start<0&&resource[j].y>1)
				start=j;
			weight+=resource[j].y;
		}
		layer[i].resource=resource;
		layer[i].weight=weight;
		layer[i].start=start;
	}
	layer.sort("start")
	var layer2 = [];
	for (var i=0;i<n;i++) 
	{
		layer2[i] = {resource:[],weight:0,start:0};
		var resource = bumpLayer(m);
		var weight=0;
		var start=-1;
		for(var j=0;j<resource.length;j++)
		{
			if(start<0&&resource[j].y>1)
				start=j;
			weight+=resource[j].y;
		}
		layer2[i].resource=resource;
		layer2[i].weight=weight;
		layer2[i].start=start;
	}
	layer2.sort("start")
	//alert(layer[0][0].y.toString())
	var svg = document.getElementById("svg1");
	var graph = new stackGraph();
	graph.makeStackGraph(svg,resort(layer));
	function myTranslate()
	{
		graph['Svg'] = svg;
		graph['Data'] = resort(layer2);
		graph.Translate();
		var tmp = layer;
		layer = layer2;
		layer2 = tmp;
	}
</script>















